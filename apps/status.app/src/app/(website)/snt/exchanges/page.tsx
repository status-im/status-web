import Link from 'next/link'

import { LEGAL } from '~/config/routes'
import { getCoins, getMarket } from '~/server/services/coingecko'
import { Metadata } from '~app/_metadata'
import { Body } from '~components/body'

import { HeroSection } from '../../_components/hero-section'
import { ExchangesTable } from './_components/exchanges-table'

import type { Ticker } from '~/server/services/coingecko'

async function getExchangeData() {
  const coins = await getCoins()
  const market = await getMarket()

  const tickers = market.tickers.reduce(
    (
      acc: {
        data: Ticker[]
        totalVolume: number
      },
      curr: Ticker
    ) => {
      if (
        curr.volume > 5000 &&
        curr.base.length < 5 &&
        curr.trust_score === 'green'
      ) {
        acc.data.push(curr)
        acc.totalVolume += curr.converted_volume.usd
      }

      if (curr.volume > 500 && curr.base.length >= 5) {
        const targetCoin = coins.find(item => item.id === curr.target_coin_id)

        curr.target =
          targetCoin?.symbol.toUpperCase() ?? curr.target_coin_id.toUpperCase()
        curr.base = 'SNT'

        acc.data.push(curr)
        acc.totalVolume += curr.converted_volume.usd
      }

      return acc
    },
    {
      data: [],
      totalVolume: 0,
    }
  )

  return tickers
}

export const revalidate = 3600 // 1 hour

export const metadata = Metadata({
  title: 'Exchanges',
  description: 'List of exchanges where you can find SNT',
})

export default async function ExchangesPage() {
  const tickers = await getExchangeData()

  return (
    <Body>
      <div className="relative">
        <HeroSection
          tag="Exchanges"
          title="Where you can find SNT"
          description={
            <>
              SNT is available on a number of exchanges. The list below is for
              informational purposes only and should not be considered an
              endorsement by Status, investment advice, or solicitation to buy
              or sell SNT or any other token.
              <span className="block pt-5 text-15 text-neutral-50">
                For more details, please refer to disclaimers in our{' '}
                <Link
                  className="underline decoration-1 underline-offset-4"
                  href={LEGAL.termsOfUse.href}
                >
                  {LEGAL.termsOfUse.name}
                </Link>
                .
              </span>
            </>
          }
          video={{
            id: 'Exchanges/Animations/Exchanges_Hero:1133:904',
            posterId: 'Exchanges/Frames/Exchanges_Hero_Frame:1133:904',
          }}
        />
      </div>

      <div className="container px-5 pb-40 pt-10 xl:pt-0">
        <ExchangesTable tickers={tickers} />
        <p className="mt-6 flex flex-row items-center gap-[6px] text-13 font-medium text-neutral-50">
          Powered by
          <a href="https://www.coingecko.com/en/coins/status" rel="noreferrer">
            <span className="sr-only">CoinGecko</span>
            <CoinGeckoIcon aria-hidden />
          </a>
        </p>
      </div>
    </Body>
  )
}

const CoinGeckoIcon = (props: React.ComponentPropsWithRef<'svg'>) => {
  return (
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="92"
      height="20"
      viewBox="0 0 92 20"
      fill="none"
      {...props}
    >
      <path
        d="M30.9873 8.25863C30.7098 7.15518 29.999 6.36207 28.5946 6.36207C26.5314 6.36207 25.6818 8.17241 25.6818 10C25.6818 11.8276 26.5487 13.6379 28.5946 13.6379C30.0857 13.6379 30.9006 12.5345 31.0393 11.1379H32.6864C32.5477 13.431 30.9179 15 28.5946 15C25.7165 15 24 12.7241 24 10C24 7.27586 25.7165 5 28.5946 5C30.7619 5.01724 32.461 6.2069 32.669 8.25863H30.9873ZM33.692 11.3103C33.692 9.18966 34.975 7.67241 37.1943 7.67241C39.4136 7.67241 40.6966 9.18966 40.6966 11.3103C40.6966 13.431 39.4136 14.9655 37.1943 14.9655C34.975 14.9655 33.692 13.431 33.692 11.3103ZM39.1708 11.3103C39.1708 10.1207 38.564 8.87931 37.1943 8.87931C35.8246 8.87931 35.2177 10.1207 35.2177 11.3103C35.2177 12.5 35.8246 13.7586 37.1943 13.7586C38.564 13.7586 39.1708 12.5172 39.1708 11.3103ZM42.0143 5.22414H43.54V6.67242H42.0143V5.22414ZM42.0143 7.86207H43.54V14.7759H42.0143V7.86207ZM45.2218 7.86207H46.6782V8.87931L46.7129 8.9138C47.1637 8.15517 47.9786 7.67241 48.8802 7.68966C50.3886 7.68966 51.3422 8.5 51.3422 10.0345V14.7759H49.8164V10.431C49.7817 9.34483 49.3656 8.87931 48.4641 8.87931C47.4411 8.87931 46.7823 9.67241 46.7823 10.6897V14.7759H45.2565V7.86207H45.2218ZM61.537 14.7759H60.462L60.2019 13.6552C59.3004 14.6724 58.4855 15 57.3065 15C54.4284 15 52.7119 12.7241 52.7119 10C52.7119 7.27586 54.4284 5 57.3065 5C59.4044 5 61.1729 6.10345 61.4156 8.25863H59.7685C59.6124 7 58.5028 6.36207 57.2891 6.36207C55.2259 6.36207 54.3763 8.17241 54.3763 10C54.3763 11.8276 55.2432 13.6379 57.2891 13.6379C59.0056 13.6724 59.9592 12.6379 59.9765 11.0172H57.4278V9.74138H61.5196L61.537 14.7759ZM64.3457 11.7069C64.3457 12.7931 64.9352 13.7586 66.2183 13.7586C67.1025 13.7586 67.64 13.3793 67.9174 12.6034H69.3738C69.0444 14.1207 67.744 14.9655 66.2183 14.9655C64.0337 14.9655 62.82 13.4483 62.82 11.3276C62.82 9.36207 64.1204 7.67241 66.1836 7.67241C68.3682 7.67241 69.7206 9.63794 69.4605 11.7069H64.3457ZM67.9174 10.7069C67.8654 9.74138 67.2065 8.87931 66.1662 8.87931C65.1086 8.87931 64.3804 9.67241 64.3284 10.7069H67.9174ZM75.3208 10.1724C75.1994 9.32759 74.5752 8.87931 73.7257 8.87931C72.9281 8.87931 71.8185 9.2931 71.8185 11.3966C71.8185 12.5517 72.3213 13.7586 73.6563 13.7586C74.5405 13.7586 75.1647 13.1724 75.3034 12.1724H76.8292C76.5518 13.9655 75.4421 14.9483 73.639 14.9483C71.4544 14.9483 70.258 13.4138 70.258 11.3793C70.258 9.2931 71.4024 7.65518 73.691 7.65518C75.3034 7.65518 76.6731 8.46552 76.8292 10.1552H75.3208V10.1724ZM78.1469 5.22414H79.6726V10.6552L82.4467 7.86207H84.3366L81.6665 10.3966L84.5793 14.7759H82.7068L80.5742 11.4138L79.6553 12.2931V14.7759H78.1295V5.22414H78.1469ZM84.9954 11.3103C84.9954 9.18966 86.2784 7.67241 88.4977 7.67241C90.7343 7.67241 92 9.18966 92 11.3103C92 13.431 90.717 14.9655 88.4977 14.9655C86.2784 14.9655 84.9954 13.431 84.9954 11.3103ZM90.4916 11.3103C90.4916 10.1207 89.8848 8.87931 88.5151 8.87931C87.1453 8.87931 86.5385 10.1207 86.5385 11.3103C86.5385 12.5 87.1453 13.7586 88.5151 13.7586C89.8848 13.7586 90.4916 12.5172 90.4916 11.3103Z"
        fill="#09101C"
      />
      <path
        d="M19.9999 9.95729C20.0126 14.0032 17.6037 17.6584 13.8707 19.2213C10.1377 20.7842 5.8371 19.9524 2.96165 17.1038C0.086206 14.2553 -0.783996 9.95729 0.74201 6.21386C2.26802 2.47044 5.91277 0.025235 9.94849 2.67132e-05C15.485 -0.0125774 19.9747 4.43668 19.9999 9.95729Z"
        fill="#8DC63F"
      />
      <path
        d="M19.2559 9.95745C19.2685 13.7009 17.0363 17.0788 13.5807 18.5283C10.1251 19.9777 6.15243 19.1963 3.49138 16.5746C0.830329 13.9404 0.0231851 9.97005 1.43569 6.51652C2.84819 3.05038 6.21549 0.794245 9.94853 0.769036C15.0688 0.743828 19.2307 4.85277 19.2559 9.95745Z"
        fill="#F9E988"
      />
      <path
        d="M10.1755 1.36127C10.7683 1.26044 11.361 1.26044 11.9538 1.36127C12.5465 1.4495 13.1267 1.65116 13.6563 1.92846C14.186 2.21835 14.64 2.60908 15.0941 2.9746C15.5481 3.34012 16.0021 3.71824 16.4309 4.13418C16.8723 4.53751 17.2507 5.00386 17.5659 5.50803C17.8938 6.01219 18.1587 6.55417 18.3605 7.10875C18.7514 8.24312 18.8776 9.46572 18.6884 10.6253H18.6253C18.4361 9.46572 18.1713 8.36916 17.7551 7.32302C17.5659 6.79365 17.3263 6.27688 17.0741 5.78532C16.7966 5.29376 16.5066 4.8022 16.1787 4.34845C15.8508 3.88209 15.4346 3.46616 14.968 3.12585C14.5013 2.78554 13.959 2.57127 13.4419 2.3696C12.9249 2.16794 12.3952 1.95366 11.8529 1.78981C11.3106 1.63856 10.7557 1.51252 10.1755 1.39908V1.36127Z"
        fill="white"
      />
      <path
        d="M14.6905 6.69278C14.0221 6.50372 13.3285 6.22643 12.6222 5.94914C12.5844 5.77268 12.4204 5.55841 12.1051 5.28112C11.6511 4.87779 10.7809 4.89039 10.0368 5.06685C9.21708 4.87779 8.39732 4.80216 7.6154 4.99123C1.22131 6.7558 4.84085 11.0412 2.49509 15.3644C2.82299 16.0703 6.42991 20.2044 11.6385 19.0952C11.6385 19.0952 9.86027 14.8224 13.8834 12.768C17.1498 11.1042 19.4955 8.00361 14.6905 6.69278Z"
        fill="#8BC53F"
      />
      <path
        d="M10.0367 5.06696C10.5034 5.10477 12.1933 5.64675 12.6221 5.94925C12.2564 4.90311 11.0457 4.76446 10.0367 5.06696Z"
        fill="#009345"
      />
      <path
        d="M15.4851 9.50352C15.4851 9.84383 15.0689 10.0203 14.8293 9.78081C14.5896 9.54134 14.7536 9.1254 15.0941 9.1128C15.3085 9.1254 15.4851 9.28925 15.4851 9.50352ZM10.4783 7.72634C10.4783 8.44478 10.0368 9.10019 9.36843 9.37748C8.70001 9.65477 7.9307 9.50352 7.41363 8.98676C6.89655 8.46999 6.74521 7.70113 7.02267 7.03312C7.30012 6.3651 7.95593 5.92395 8.67479 5.92395C9.15403 5.92395 9.60805 6.11301 9.93595 6.44072C10.2891 6.79364 10.4783 7.24739 10.4783 7.72634Z"
        fill="white"
      />
      <path
        d="M9.94855 7.73896C9.94855 8.24312 9.64587 8.70948 9.16663 8.89854C8.7 9.0876 8.1577 8.98677 7.79196 8.62125C7.42622 8.25573 7.32533 7.72635 7.51451 7.2474C7.70368 6.78104 8.17031 6.46594 8.67477 6.46594C9.38103 6.47855 9.94855 7.04573 9.94855 7.73896Z"
        fill="#58595B"
      />
      <path
        d="M16.9353 10.2976C15.4849 11.3185 13.8328 12.0874 11.4997 12.0874C10.4025 12.0874 10.1881 10.9278 9.45658 11.495C9.07823 11.7849 7.76662 12.4403 6.71986 12.4025C5.67309 12.352 3.98314 11.7344 3.51651 9.51611C3.32733 11.747 3.23905 13.3856 2.39407 15.2636C4.05881 17.9357 8.03147 19.9901 11.6384 19.1079C11.2474 16.398 13.6184 13.7511 14.9426 12.4025C15.4597 11.8731 16.4308 11.0412 16.9353 10.2976Z"
        fill="#8BC53F"
      />
      <path
        d="M16.8724 10.3607C16.4184 10.7767 15.8887 11.0792 15.3464 11.3438C14.7915 11.6085 14.2239 11.8102 13.6312 11.974C13.0384 12.1253 12.4205 12.2387 11.8025 12.1883C11.1719 12.1379 10.5413 11.9236 10.1252 11.4573L10.1504 11.4321C10.6548 11.7598 11.2476 11.8732 11.8277 11.8984C12.4205 11.911 13.0132 11.8732 13.5933 11.7598C14.1735 11.6337 14.7536 11.4573 15.3085 11.2304C15.8634 11.0035 16.4057 10.7388 16.885 10.3607H16.8724Z"
        fill="#58595B"
      />
    </svg>
  )
}
